# === WEZTERM COMPATIBILITY ===
# Use tmux-256color for better compatibility with modern terminals like Wezterm
set -g default-terminal "tmux-256color"

# === SHELL CONFIGURATION ===
# Set zsh as the default shell for tmux sessions (use clean zsh without env inheritance)
set -g default-shell /run/current-system/sw/bin/zsh

# Clear virtual environment when starting new sessions
# set-environment -gu VIRTUAL_ENV
# set-environment -gu CONDA_DEFAULT_ENV

# Enable RGB color support (essential for Wezterm themes)
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",wezterm:Tc"

# Enable undercurl support for Wezterm
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

unbind C-b
set -g prefix C-a
bind-key C-a send-prefix

set -g mouse on

unbind %
bind '\' split-window -h -c '#{pane_current_path}'
bind 'Â¥' split-window -h -c '#{pane_current_path}'

unbind '"'
bind - split-window -v -c '#{pane_current_path}'

unbind r 
# tmux source-file ~/.tmux.conf \;
bind r source-file ~/Workspaces/Config/nixos/dotfiles/tmux/tmux.conf

bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r h resize-pane -L 5
bind -r l resize-pane -R 5

bind -r m resize-pane -Z

# Copy vim movements
set-window-option -g mode-keys vi

bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection

unbind -T copy-mode-vi MouseDragEnd1Pane

# new window
bind c new-window -c '#{pane_current_path}'

# start from 1, not 0
set-option -g base-index 1
# re-number when closing windows
set-option -g renumber-windows on

# open a note for billion $ idea
bind -r e split-window -h "nvim ~/Documents/git/scratch/notes_$(date +'%Y%m%d%H').md"
bind -r v split-window -h -c "#{pane_current_path}" "zsh -c 'nvim; exec zsh'"
bind -r o split-window -h "nvim ~/Documents/git/scratch/todo_$(date +'%y%m%d').md"

# === TOKYO NIGHT THEME (matching Wezterm) ===
# Status bar configuration with Tokyo Night theme - using direct colors
set -g status-interval 1
set -g status-position bottom
set -g status-justify left
set -g status-style "fg=#c0caf5,bg=#1a1b26"

# Left status
set -g status-left-length 100
set -g status-left "#[fg=#1a1b26,bg=#7aa2f7,bold] #S #[fg=#7aa2f7,bg=#1a1b26,nobold]"

# Window status
set -g window-status-separator ""
set -g window-status-format "#[fg=#a9b1d6,bg=#1a1b26] #I:#W "
set -g window-status-current-format "#[fg=#1a1b26,bg=#bb9af7]#[fg=#1a1b26,bg=#bb9af7,bold] #I:#W #[fg=#bb9af7,bg=#1a1b26,nobold]"

# Right status
set -g status-right-length 150
set -g status-right "#[fg=#545c7e,bg=#1a1b26]#[fg=#c0caf5,bg=#545c7e] %Y-%m-%d #[fg=#7aa2f7,bg=#545c7e]#[fg=#1a1b26,bg=#7aa2f7,bold] %H:%M:%S "

# Pane borders
set -g pane-border-style "fg=#292e42"
set -g pane-active-border-style "fg=#7aa2f7"

# Message style
set -g message-style "fg=#c0caf5,bg=#292e42"
set -g message-command-style "fg=#c0caf5,bg=#292e42"

# Copy mode
set -g mode-style "fg=#1a1b26,bg=#7aa2f7"

# Clock
set -g clock-mode-colour "#7aa2f7"

# === PERFORMANCE OPTIMIZATIONS ===
set -g escape-time 0
set -g repeat-time 600
set -g focus-events on
set -g aggressive-resize on

# === SESSION MANAGEMENT ===
# tmux-resurrect plugin for session save/restore
# Install: git clone https://github.com/tmux-plugins/tmux-resurrect ~/.tmux/plugins/tmux-resurrect
run-shell ~/.tmux/plugins/tmux-resurrect/resurrect.tmux

# Key bindings for session save/restore (when using tmux-resurrect)
# Ctrl-a + Ctrl-s: save session
# Ctrl-a + Ctrl-r: restore session

# Manual session management bindings
bind S command-prompt -p "Save session to:" "run-shell 'tmux list-sessions > %1'"
bind R source-file ~/Workspaces/Config/nixos/dotfiles/tmux/tmux.conf \; display-message "Config reloaded!"
