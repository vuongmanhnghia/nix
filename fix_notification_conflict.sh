#!/bin/bash

echo "üîß FIXING QUICKSHELL NOTIFICATION CONFLICT"
echo "=========================================="

CONFIG_FILE="$HOME/.config/illogical-impulse/config.json"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

print_info() {
    echo -e "${BLUE}‚ÑπÔ∏è${NC} $1"
}

print_success() {
    echo -e "${GREEN}‚úÖ${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}‚ö†Ô∏è${NC} $1"
}

if [ ! -f "$CONFIG_FILE" ]; then
    print_warning "Config file kh√¥ng t·ªìn t·∫°i: $CONFIG_FILE"
    print_info "T·∫°o config file m·ªõi..."
    mkdir -p "$(dirname "$CONFIG_FILE")"
    echo '{}' > "$CONFIG_FILE"
fi

print_info "C·∫≠p nh·∫≠t config ƒë·ªÉ t·ª± ƒë·ªông kill notification daemons conflicts..."

# Update config to auto kill notification daemons
jq '.conflictKiller.autoKillNotificationDaemons = true | .conflictKiller.autoKillTrays = true' "$CONFIG_FILE" > "$CONFIG_FILE.tmp" && mv "$CONFIG_FILE.tmp" "$CONFIG_FILE"

print_success "ƒê√£ c·∫≠p nh·∫≠t config!"

echo ""
print_info "Config hi·ªán t·∫°i:"
jq '.conflictKiller' "$CONFIG_FILE" 2>/dev/null || echo "Ch∆∞a c√≥ section conflictKiller"

echo ""
print_warning "Gi·∫£i th√≠ch:"
echo "‚Ä¢ autoKillNotificationDaemons = true: T·ª± ƒë·ªông kill mako/dunst conflicts"
echo "‚Ä¢ autoKillTrays = true: T·ª± ƒë·ªông kill kded6 tray conflicts"
echo "‚Ä¢ ƒêi·ªÅu n√†y s·∫Ω tr√°nh dialog xu·∫•t hi·ªán m·ªói l·∫ßn rebuild"

echo ""
print_info "Restart QuickShell ƒë·ªÉ √°p d·ª•ng config m·ªõi:"
echo "pkill quickshell && qs -c ii &" 